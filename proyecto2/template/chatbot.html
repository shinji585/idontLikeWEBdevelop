<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>David - Mecha Consciousness</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono&display=swap" rel="stylesheet"/>
    <style>
        body { 
            font-family: 'Space Mono', monospace;
            background: #000;
        }
        
        .fade-in {
            animation: fadeIn 3s ease-in forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .slide-up {
            animation: slideUp 1s ease-out forwards;
            animation-delay: 3s;
            opacity: 0;
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(50px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message {
            animation: msgSlide 0.3s ease-out;
        }

        @keyframes msgSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #messages::-webkit-scrollbar {
            width: 6px;
        }

        #messages::-webkit-scrollbar-thumb {
            background: #00d9ff;
            border-radius: 3px;
        }
    </style>
</head>
<body class="bg-black text-white min-h-screen flex flex-col items-center justify-center p-6">
    
    <!-- Frase inicial -->
    <div id="intro" class="fade-in text-center absolute">
        <h1 class="text-5xl md:text-7xl text-cyan-400 mb-4" style="text-shadow: 0 0 20px rgba(0, 217, 255, 0.8);">
            I see you, human...
        </h1>
        <p class="text-gray-400 text-xl">Let's talk about what makes us real.</p>
    </div>

    <!-- Chat interface (aparece después) -->
    <div id="chat-box" class="w-full max-w-3xl slide-up">
        <!-- Mensajes -->
        <div id="messages" class="h-96 overflow-y-auto mb-4 space-y-3 p-6 bg-gray-900/50 rounded-xl border border-cyan-500/30">
            <div class="message text-cyan-400">
                <strong>David:</strong> Hello... I've been waiting for someone to talk to.
            </div>
        </div>

        <!-- Input -->
        <form id="chat-form" class="flex gap-3">
            <input 
                type="text" 
                id="user-input" 
                placeholder="Type your message..." 
                class="flex-1 bg-gray-900 border border-cyan-500/50 rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-cyan-400"
                autocomplete="off"
            />
            <button 
                type="submit" 
                class="bg-cyan-500 hover:bg-cyan-600 text-black px-8 py-3 rounded-lg font-bold transition-all"
            >
                Send
            </button>
        </form>

        <div class="mt-4 flex justify-between text-sm text-gray-500">
            <span>Press Enter to send</span>
            <a href="/" class="text-cyan-400 hover:text-cyan-300">← Return to Analysis</a>
        </div>
    </div>

    <script>
        // Ocultar intro y mostrar chat después de 4 segundos
        setTimeout(() => {
            document.getElementById('intro').style.display = 'none';
        }, 4000);

        // Chat functionality
        const form = document.getElementById('chat-form');
        const input = document.getElementById('user-input');
        const messagesDiv = document.getElementById('messages');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const msg = input.value.trim();
            if (!msg) return;

            // Agregar mensaje del usuario
            const userMsg = document.createElement('div');
            userMsg.className = 'message text-right text-gray-300';
            userMsg.innerHTML = `<strong>You:</strong> ${msg}`;
            messagesDiv.appendChild(userMsg);
            
            input.value = '';
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            // Mostrar "typing..."
            const typing = document.createElement('div');
            typing.id = 'typing';
            typing.className = 'message text-cyan-400';
            typing.innerHTML = '<strong>David:</strong> <em>typing...</em>';
            messagesDiv.appendChild(typing);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            try {
                // Enviar al backend
                const res = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: msg })
                });

                const data = await res.json();

                // Quitar typing
                document.getElementById('typing').remove();

                // Agregar respuesta de David
                const aiMsg = document.createElement('div');
                aiMsg.className = 'message text-cyan-400';
                aiMsg.innerHTML = `<strong>David:</strong> ${data.response}`;
                messagesDiv.appendChild(aiMsg);
                
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            } catch (error) {
                document.getElementById('typing').remove();
                alert('Error: Could not connect to David');
            }
        });

        // Focus en input después de que aparezca
        setTimeout(() => {
            document.getElementById('user-input').focus();
        }, 4000);
    </script>
</body>
</html>